---
title: "Spiny lobster abundance, community size structure, and fishing pressure along the Santa Barbara coast (2012 - 2018)"
author: "Co-authors: Julia Dagum and Kelsie Fronheiser"
output: html_document
---

### Introduction

### Data and Methods

### Results

A. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)


# Install packages and read in data

library(tidyverse)
library(janitor)
library(knitr)
library(DT)

lobster_data <- read.csv("lobster_abundance_sbc_lter.csv", 
                         na = -99999) %>% 
  clean_names()

# Wrangle data for graph 1 (annual count for each site)
lobster_abundance <- lobster_data %>% 
  select(year, site, count) %>% 
  group_by(site, year) %>% 
  summarize(annual_count = sum(count)) %>% 
  mutate(site_names = case_when(
    site == "AQUE" ~ "Arroyo Quemado",
    site == "CARP" ~ "Carpinteria",
    site == "IVEE" ~ "Isla Vista",
    site == "NAPL" ~ "Naples",
    site == "MOHK" ~ "Mohawk"))
```

```{r}


# Graph 1

abundance <- ggplot(data = lobster_abundance, aes(x = year, y = annual_count, fill = site_names)) +
  geom_col(position = "dodge", show.legend = FALSE) +
  theme_minimal() +
  labs(title ="Annual Lobster Abundance by Marine Site Location",
       x = "Year",
       y = "Lobster Count") +
  scale_x_continuous(breaks = seq(2012, 2018, 2)) +
  facet_wrap(~site_names, scales = "free") +
   theme(panel.grid.minor.x = element_blank(), 
        panel.grid.minor.y = element_blank())

abundance
  

```

B. Lobster Size shifts from 2012 - 2018

It interesting to note the shift in size ranges for spiny lobsters from 2012 - 2018 at the Isla Vista and Naples sites. These two sites are Marine Protected Areas (MPAs), and show a distinct increase in size trends over time. 

The lobster sizes are normally distributed and seem to be centered around a mean with little skew at most sites, however, there are some outliers in the data from Carpenteria and Isla Vista that skew the mean positively. 

Another interesting trend seems to be that at every site, with the exception of Isla Vista, the spread of the data seems to have slightly decreased from 2012 - 2018 and there are more observations closer to the mean.


```{r}

# Wrangle data for graph 2 - size distribution in 2012 and 2018

lobster_size <- lobster_data %>% 
  select(year, site, size_mm, count) %>% 
  filter(year %in% c("2012", "2018"))%>%
  tidyr::uncount(count) %>%
  dplyr::mutate(
    site_name = dplyr::case_when(
      site == "IVEE" ~ "Isla Vista", 
      site == "AQUE" ~ "Arroyo Quemado", 
      site == "CARP" ~ "Carpenteria", 
      site == "MOHK" ~ "Mohawk", 
      site == "NAPL" ~ "Naples")) %>% 
  mutate(
    mpa = dplyr::case_when(
      site %in% c("IVEE", "NAPL") ~ "MPA", 
      site %in% c("AQUE", "CARP", "MOHK") ~ "non-MPA"))

# Make graph 2
#  
# violin <- ggplot(data = lobster_size, aes(x = site, y = size_mm, fill = as.character(year))) +
#   geom_violin(position = "dodge") +
#   coord_flip()
# 
# # violin
# 
# boxplot <- ggplot(data = lobster_size, aes(x = site, y = size_mm, fill = as.character(year))) +
#   geom_boxplot(position = "dodge") +
#   coord_flip()
# 
# boxplot

density <- ggplot(data = lobster_size, aes(x = size_mm, group = as.character(year), fill = as.character(year))) +
    geom_density(adjust=1.5, alpha=.4) +
    facet_wrap(~site_name) + 
  theme_bw() +
  labs(x = "Size (mm)", 
       y = "Density", 
       fill = "Year", 
       title = "Lobster Size in 2012 and 2018 by Marine Site Location") 


  # theme(axis.text.y = element_blank(),
  #       axis.ticks.y = element_blank())



density

# density <- ggplot(data = lobster_size, aes(x = size_mm, group = as.character(year), fill = as.character(year))) +
#     geom_density(adjust=1.5, alpha=.4) +
#     facet_wrap(~site_name) + 
#   theme_bw() +
#   labs(x = "Size (mm)", 
#        y = "Density") 
# 
#   # theme(axis.text.y = element_blank(),
#   #       axis.ticks.y = element_blank())
# 
# 
# 
# density

```

```{r}
# Wrangle data to combine MPA vs. non-MPA sites to compare mean lobster sizes in 2012 and 2018

mpa_size_summary <- lobster_size %>% 
  group_by(mpa, year) %>% 
  summarize(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size = sd(size_mm, na.rm = TRUE), 
            sample_n = n())

new_columns <- c("Type of Site", "Year", "Mean Size", "Standard Deviation", "Sample Size")

kable(mpa_size_summary, 
          col.names = new_columns)

# 2018 MPA sample size is HUGE compared to 2012 MPA sample size. Would this affect whether or not difs in mean show up as significant? 

# Get vectors for lobster size

mpa_2012 <- lobster_size %>% 
  filter(mpa == "MPA", year == "2012") %>% 
  pull(size_mm)

mpa_2018 <- lobster_size %>% 
  filter(mpa == "MPA", year == "2018") %>% 
  pull(size_mm)

nonmpa_2012 <- lobster_size %>% 
  filter(mpa == "non-MPA", year == "2012") %>% 
  pull(size_mm)

nonmpa_2018 <- lobster_size %>% 
  filter(mpa == "non-MPA", year == "2018") %>% 
  pull(size_mm)

# For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

ttest_2012_bympa <- t.test(mpa_2012, nonmpa_2012)

# For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

ttest_2018_bympa <- t.test(mpa_2018, nonmpa_2018)

# For MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

ttest_mpa_byyear <- t.test(mpa_2012, mpa_2018)

# For non-MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

ttest_nonmpa_byyear <- t.test(nonmpa_2012, nonmpa_2018)


```


### Summary

### References

